import{r as l,j as e,N as M,L as N,u as B,M as ae,a as z,b as V,B as ne,R as oe,c as E,d as ie,e as le}from"./react-vendor-BUKM4_0D.js";import{n as ce,o as de,q as me,w as ue}from"./vendor-7--NnevP.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const f="http://localhost:4000/api",se=l.createContext(void 0),he=({children:o})=>{const[s,t]=l.useState(null),[r,a]=l.useState(null),[n,i]=l.useState(!1),[d,m]=l.useState(!0);async function g(){const h=await fetch(`${f}/auth/user`,{credentials:"include"});if(!h.ok)throw new Error("Error fetching user info");return h.json()}const c=async()=>{try{const h=await g();t(h._id),a(h.role),i(!0)}catch(h){throw console.error("Login failed:",h),h}},p=async()=>{try{await fetch(`${f}/auth/logout`,{method:"POST",credentials:"include"})}catch(h){console.error("Logout error:",h)}finally{t(null),a(null),i(!1)}};return l.useEffect(()=>{g().then(h=>{t(h._id),a(h.role),i(!0)}).catch(()=>{}).finally(()=>m(!1))},[]),e.jsx(se.Provider,{value:{role:r,_id:s,isLoggedIn:n,isLoading:d,login:c,logout:p},children:o})},b=()=>{const o=l.useContext(se);if(!o)throw new Error("useAuth must be used inside an AuthProvider");return o},ge=()=>{const{role:o,isLoggedIn:s,logout:t}=b(),[r,a]=l.useState(!1),n=l.useRef(0);return l.useEffect(()=>{n.current=window.scrollY;const i=()=>{const d=window.scrollY;d>n.current&&d>80?a(!0):d<n.current&&a(!1),n.current=d};return window.addEventListener("scroll",i,{passive:!0}),()=>window.removeEventListener("scroll",i)},[]),e.jsxs("nav",{className:`navbar ${r?"hidden":""}`,children:[e.jsx(M,{to:"/",className:({isActive:i})=>i?"active":void 0,children:"Home"}),e.jsx(M,{to:"/blog",className:({isActive:i})=>i?"active":void 0,children:"Blog"}),s&&o==="admin"&&e.jsx(M,{to:"/users",className:({isActive:i})=>i?"active":void 0,children:"Users"}),s?e.jsxs(e.Fragment,{children:[e.jsx(M,{to:"/dashboard",className:({isActive:i})=>i?"active":void 0,children:"Dashboard"}),e.jsx("button",{onClick:t,children:"Log Out"})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{to:"/login",className:({isActive:i})=>i?"active":void 0,children:"Log In"}),e.jsx(M,{to:"/signup",className:({isActive:i})=>i?"active":void 0,children:"Sign Up"})]})]})};function pe(){return e.jsxs("svg",{viewBox:"0 0 600 150",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-auto",children:[e.jsx("rect",{width:"600",height:"150",fill:"#0d1318"}),e.jsxs("g",{transform:"translate(70, 75)",stroke:"#47ebb4",strokeWidth:"1",fill:"none",opacity:"0.3",children:[e.jsx("circle",{r:"35"}),e.jsx("path",{d:"M 0 -35 L 0 -42 M 35 0 L 42 0 M 0 35 L 0 42 M -35 0 L -42 0"}),e.jsx("circle",{r:"22"}),e.jsx("path",{d:"M -15 0 L 15 0 M 0 -15 L 0 15"}),e.jsx("path",{d:"M -10 -10 L 10 10 M -10 10 L 10 -10"})]}),e.jsxs("g",{transform:"translate(530, 75)",stroke:"#47ebb4",strokeWidth:"1",fill:"none",opacity:"0.3",children:[e.jsx("circle",{r:"35"}),e.jsx("path",{d:"M 0 -35 L 0 -42 M 35 0 L 42 0 M 0 35 L 0 42 M -35 0 L -42 0"}),e.jsx("circle",{r:"22"}),e.jsx("path",{d:"M -15 0 L 15 0 M 0 -15 L 0 15"}),e.jsx("path",{d:"M -10 -10 L 10 10 M -10 10 L 10 -10"})]}),e.jsxs("g",{transform:"translate(300, 75)",stroke:"#47ebb4",strokeWidth:"0.8",fill:"none",opacity:"0.25",children:[e.jsx("path",{d:"M 0,-40 L 34.64,-20 L 34.64,20 L 0,40 L -34.64,20 L -34.64,-20 Z"}),e.jsx("circle",{r:"28"}),e.jsx("path",{d:"M 0,-20 L 17.32,-10 L 17.32,10 L 0,20 L -17.32,10 L -17.32,-10 Z"}),e.jsx("path",{d:"M -18 0 L 18 0 M 0 -18 L 0 18"}),e.jsx("circle",{r:"5"})]}),e.jsx("path",{d:"M 110 75 L 265 75",stroke:"#4a5f78",strokeWidth:"0.5",opacity:"0.3"}),e.jsx("path",{d:"M 335 75 L 490 75",stroke:"#4a5f78",strokeWidth:"0.5",opacity:"0.3"}),e.jsx("text",{x:"300",y:"62",fontFamily:"'Courier New', monospace",fontSize:"24",fontWeight:"bold",fill:"#ebf4ff",textAnchor:"middle",letterSpacing:"6",children:"STEALTH CRACKS"}),e.jsx("line",{x1:"210",y1:"75",x2:"390",y2:"75",stroke:"#4a5f78",strokeWidth:"0.3",opacity:"0.3"}),e.jsx("text",{x:"300",y:"93",fontFamily:"'Courier New', monospace",fontSize:"8",fill:"#57718e",textAnchor:"middle",opacity:"0.7",letterSpacing:"3",children:"REVERSE • CRACK • DISASM"}),e.jsxs("g",{stroke:"#47ebb4",strokeWidth:"0.8",fill:"none",opacity:"0.2",children:[e.jsx("circle",{cx:"40",cy:"125",r:"5"}),e.jsx("path",{d:"M 40 115 L 40 135 M 30 125 L 50 125"}),e.jsx("circle",{cx:"560",cy:"125",r:"5"}),e.jsx("path",{d:"M 560 115 L 560 135 M 550 125 L 570 125"})]}),e.jsx("text",{x:"25",y:"140",fontFamily:"monospace",fontSize:"7",fill:"#57718e",opacity:"0.5",children:"0x00"}),e.jsx("text",{x:"575",y:"140",fontFamily:"monospace",fontSize:"7",fill:"#57718e",opacity:"0.5",textAnchor:"end",children:"0xFF"}),e.jsx("path",{d:"M 20 20 L 30 20 L 30 30",stroke:"#4a5f78",strokeWidth:"0.5",opacity:"0.2"}),e.jsx("path",{d:"M 580 20 L 570 20 L 570 30",stroke:"#4a5f78",strokeWidth:"0.5",opacity:"0.2"}),e.jsx("path",{d:"M 20 130 L 30 130 L 30 120",stroke:"#4a5f78",strokeWidth:"0.5",opacity:"0.2"}),e.jsx("path",{d:"M 580 130 L 570 130 L 570 120",stroke:"#4a5f78",strokeWidth:"0.5",opacity:"0.2"})]})}function xe(){const{isLoggedIn:o,role:s}=b();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"page-container",children:[e.jsx("div",{className:"header",children:e.jsx("div",{className:"post-summary",children:"root@localhost:~# cat WELCOME.md"})}),e.jsxs("div",{className:"post-content",children:[e.jsx("h1",{className:"title large left",children:"# Welcome"}),e.jsx(pe,{}),e.jsxs("div",{className:"post-body",children:[e.jsx("br",{}),e.jsxs("p",{children:["This blog is all about getting into the guts of technology. We’ll explore ",e.jsx("strong",{children:"reverse engineering embedded systems"}),", break down firmware, and learn how to bypass software protections. It’s not about shortcuts, but understanding how things really work and how to make them work for you."]}),e.jsx("br",{}),o&&s==="admin"&&e.jsxs("p",{children:["As an admin, you can ",e.jsx(N,{to:"/blog/new",className:"link",children:"create new posts"})," or ",e.jsx(N,{to:"/blog",className:"link",children:"manage existing posts"}),"."]}),e.jsx("p",{children:e.jsx(N,{to:"/blog",className:"link",children:"Start reading the blog →"})})]})]})]})})}class X{static async _signUp(s,t,r,a=!1){const n=a?"signup-admin":"signup",d={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s,email:t,password:r})};a&&(d.credentials="include");const m=await fetch(`${f}/auth/${n}`,d);if(!m.ok){let g=m.statusText;try{const c=await m.json();g=c?.message||c?.error||g}catch{}throw new Error(`Failed to signup: ${g}`)}return await m.json()}static async signUp(s,t,r){return this._signUp(s,t,r)}static async signUpAdmin(s,t,r,a){if(a!=="admin")throw new Error("Only admins can create admin accounts");return this._signUp(s,t,r,!0)}static async logIn(s,t){const r=await fetch(`${f}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:s,password:t})});if(!r.ok){let a=r.statusText;try{const n=await r.json();a=n?.message||n?.error||a}catch{}throw new Error(`Failed to login: ${a}`)}return await r.json()}static async logout(){const s=await fetch(`${f}/auth/logout`,{method:"POST",credentials:"include"});if(!s.ok){let t=s.statusText;try{const r=await s.json();t=r?.message||r?.error||t}catch{}throw new Error(`Failed to logout: ${t}`)}return await s.json()}}const fe={VITE_MAX_CONTENT_LENGTH:"20000",VITE_MAX_SUMMARY_LENGTH:"1000",VITE_MAX_TITLE_LENGTH:"300",VITE_MIN_PASSWORD_LENGTH:"8"},G=fe||{},Y=Number(G.VITE_MIN_PASSWORD_LENGTH)||6,K=Number(G.VITE_MAX_TITLE_LENGTH)||300,Z=Number(G.VITE_MAX_SUMMARY_LENGTH)||1e3,Q=Number(G.VITE_MAX_CONTENT_LENGTH)||2e4;function je(o){return typeof o!="string"?!1:/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(o)}function ye(o,s,t){return!o||o.trim().length===0?"Name is required":!s||!je(s)?"A valid email is required":!t||t.length<Y?`Password must be at least ${Y} characters`:null}function we(o,s){return!o||o.trim().length===0?"Name is required":s?null:"Password is required"}function Ne(o,s,t){return!o||o.trim().length===0?"Title is required":o.length>K?`Title must be ${K} characters or less`:!s||s.trim().length===0?"Summary is required":s.length>Z?`Summary must be ${Z} characters or less`:!t||t.trim().length===0?"Content is required":t.length>Q?`Content must be ${Q} characters or less`:null}function ve(){const o=B(),{role:s}=b(),[t,r]=l.useState(""),[a,n]=l.useState(""),[i,d]=l.useState(""),[m,g]=l.useState(""),[c,p]=l.useState(!1),h=async()=>{const x=ye(t,a,i);if(x){g(x);return}try{p(!0),g(""),s==="admin"?await X.signUpAdmin(t.trim(),a.trim(),i,s):await X.signUp(t.trim(),a.trim(),i),o(s==="admin"?"/users":"/login")}catch(y){const v=y?.response?.data?.message||y?.message||"Signup failed. Please try again.";g(String(v))}finally{p(!1)}};return e.jsx("div",{className:"page-container centered",children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:"title",style:{marginBottom:"1rem"},children:s==="admin"?"Create Admin":"Sign Up"}),m&&e.jsx("div",{className:"error block",children:m}),e.jsxs("form",{className:"form",onSubmit:x=>{x.preventDefault(),h()},children:[e.jsx("input",{type:"text",placeholder:"Name",value:t,onChange:x=>r(x.target.value),className:"input",disabled:c}),e.jsx("input",{type:"email",placeholder:"Email",value:a,onChange:x=>n(x.target.value),className:"input",disabled:c}),e.jsx("input",{type:"password",placeholder:"Password",value:i,onKeyDown:x=>{x.key==="Enter"&&h()},onChange:x=>d(x.target.value),className:"input",disabled:c}),e.jsx("button",{type:"submit",className:"button",disabled:c,children:c?"Creating...":s==="admin"?"Create Admin":"Sign Up"})]})]})})}function be(){const{login:o}=b(),s=B(),[t,r]=l.useState(""),[a,n]=l.useState(""),[i,d]=l.useState(""),[m,g]=l.useState(!1),c=async()=>{const p=we(t,a);if(p){d(p);return}try{g(!0),d(""),await X.logIn(t.trim(),a),await o(),s("/blog")}catch(h){const x=h?.response?.data?.message||h?.message||"Login failed. Please check your credentials.";d(String(x))}finally{g(!1)}};return e.jsx("div",{className:"page-container centered",children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:"title center left",style:{marginBottom:"1rem"},children:"Login"}),i&&e.jsx("div",{className:"error block",children:i}),e.jsxs("form",{className:"form",onSubmit:p=>{p.preventDefault(),c()},children:[e.jsx("input",{type:"text",placeholder:"Name",value:t,onChange:p=>r(p.target.value),className:"input",disabled:m}),e.jsx("input",{type:"password",placeholder:"Password",value:a,onKeyDown:p=>{p.key==="Enter"&&c()},onChange:p=>n(p.target.value),className:"input",disabled:m}),e.jsx("button",{onClick:c,className:"button",disabled:m,children:m?"Loading...":"Login"}),e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"4px"},children:e.jsxs("p",{children:["Or"," ",e.jsx(N,{to:"/signup",className:"link login",children:"sign up"})," ","to make an account."]})})]})]})})}class U{static async getAllPosts(){try{const s=await fetch(`${f}/posts`);if(!s.ok){let t=s.statusText;try{const r=await s.json();t=r?.message||r?.error||t}catch{}throw new Error(`Failed to fetch posts: ${t}`)}return await s.json()}catch(s){throw console.error("Error fetching posts:",s),s}}static async getPostById(s){try{const t=await fetch(`${f}/posts/${s}`);if(!t.ok){let r=t.statusText;try{const a=await t.json();r=a?.message||a?.error||r}catch{}throw new Error(`Failed to fetch post: ${r}`)}return await t.json()}catch(t){throw console.error(`Error fetching post ${s}:`,t),t}}static async createPost(s,t,r){try{const a=await fetch(`${f}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:s,summary:t,content:r})});if(!a.ok){let n=a.statusText;try{const i=await a.json();n=i?.message||i?.error||n}catch{}throw new Error(`Failed to create post: ${n}`)}return await a.json()}catch(a){throw console.error("Error creating post:",a),a}}static async updatePost(s,t){try{const r=await fetch(`${f}/posts/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(!r.ok){let a=r.statusText;try{const n=await r.json();a=n?.message||n?.error||a}catch{}throw new Error(`Failed to update post: ${a}`)}return await r.json()}catch(r){throw console.error(`Error updating post ${s}:`,r),r}}static async deletePost(s){try{const t=await fetch(`${f}/posts/${s}`,{method:"DELETE",credentials:"include"});if(!t.ok){let r=t.statusText;try{const a=await t.json();r=a?.message||a?.error||r}catch{}throw new Error(`Failed to delete post: ${r}`)}}catch(t){throw console.error(`Error deleting post ${s}:`,t),t}}}function Ee(){const[o,s]=l.useState([]),[t,r]=l.useState(!0),[a,n]=l.useState(""),{isLoggedIn:i,role:d}=b();return l.useEffect(()=>{U.getAllPosts().then(m=>{s(m),m.length===0&&n("No available posts.")}).catch(()=>n("Error loading posts.")).finally(()=>r(!1))},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"header",children:[e.jsx(N,{to:"/",className:"link",children:"$ cd ../"}),i&&d==="admin"&&e.jsx(N,{to:"/blog/new",className:"button compact",children:"Create New post"})]}),e.jsx("div",{className:"post-content",children:e.jsx("h1",{className:"title large left",children:"# Blog"})}),t?e.jsx("p",{children:"Loading posts..."}):a?e.jsx("p",{className:"error block",children:a}):e.jsx("ul",{className:"post-list",children:o.map(m=>e.jsx("div",{className:"post-wrapper",children:e.jsxs("li",{className:"post-item",children:[e.jsxs("div",{className:"post-header",children:[e.jsxs(N,{to:`/blog/${m._id}`,className:"post-title",children:["./",m.title]}),e.jsx("div",{className:"post-date",children:new Date(m.createdAt).toLocaleString().split(",")[0]})]}),e.jsx("div",{className:"post-summary margin",children:m.summary})]})},m._id))})]})})}function Le({content:o}){return e.jsx("div",{className:"prose",children:e.jsx(ae,{rehypePlugins:[ce,[de,me],ue],children:o})})}class q{static async getCommentsByPost(s){try{const t=await fetch(`${f}/comments/${s}`);if(!t.ok){let r=t.statusText;try{const a=await t.json();r=a?.message||a?.error||r}catch{}throw new Error(`Failed to fetch comments: ${r}`)}return await t.json()}catch(t){throw console.error(`Error fetching comments for post ${s}:`,t),t}}static async getCommentById(s,t){try{const r=await fetch(`${f}/comments/${s}/${t}`);if(!r.ok){let a=r.statusText;try{const n=await r.json();a=n?.message||n?.error||a}catch{}throw new Error(`Failed to fetch comment: ${a}`)}return await r.json()}catch(r){throw console.error(`Error fetching comment ${t}:`,r),r}}static async createComment(s,t){try{const r=await fetch(`${f}/comments/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:t})});if(!r.ok){let a=r.statusText;try{const n=await r.json();a=n?.message||n?.error||a}catch{}throw new Error(`Failed to create comment: ${a}`)}return await r.json()}catch(r){throw console.error(`Error creating comment for post ${s}:`,r),r}}static async updateComment(s,t,r){try{const a=await fetch(`${f}/comments/${s}/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(r)});if(!a.ok){let n=a.statusText;try{const i=await a.json();n=i?.message||i?.error||n}catch{}throw new Error(`Failed to update comment: ${n}`)}return await a.json()}catch(a){throw console.error(`Error updating comment ${t}:`,a),a}}static async deleteComment(s,t){try{const r=await fetch(`${f}/comments/${s}/${t}`,{method:"DELETE",credentials:"include"});if(!r.ok){let a=r.statusText;try{const n=await r.json();a=n?.message||n?.error||a}catch{}throw new Error(`Failed to delete comment: ${a}`)}}catch(r){throw console.error(`Error deleting comment ${t}:`,r),r}}}function Se({postId:o,comment:s,setComments:t}){const{role:r}=b(),a=async n=>{try{await q.deleteComment(o,n),t(i=>i.filter(d=>d._id!==n))}catch{alert("Failed to delete comment")}};return e.jsxs("div",{className:"comment",children:[e.jsxs("div",{className:"comment-header",children:[s.author?e.jsx("span",{className:"comment-author",children:s.author.name}):e.jsx("span",{style:{color:"var(--color-text-1)"},className:"comment-author",children:"deleted user"}),e.jsx("span",{className:"comment-date",style:{marginLeft:"auto"},children:new Date(s.createdAt).toLocaleString()}),r==="admin"?e.jsx("button",{className:"button compact delete",style:{marginLeft:"1rem",height:"1.5rem",textAlign:"center",padding:"0 0.5rem"},onClick:()=>a(s._id),children:"Delete"}):null]}),e.jsx("div",{className:"comment-body",children:e.jsx("p",{style:{whiteSpace:"pre-wrap"},children:s.content})})]})}function Te({postId:o}){const{isLoggedIn:s}=b(),[t,r]=l.useState([]),[a,n]=l.useState(!0),i=2e3,[d,m]=l.useState(""),[g,c]=l.useState(0),[p,h]=l.useState(!1);l.useEffect(()=>{n(!0),q.getCommentsByPost(o).then(y=>r(y)).finally(()=>n(!1))},[o]);const x=async y=>{if(y.preventDefault(),!!d.trim()){h(!0);try{const v=await q.createComment(o,d.trim());r(P=>[v,...P]),m(""),c(0)}catch{alert("Failed to post comment")}h(!1)}};return e.jsxs("div",{className:"page-content",style:{maxWidth:"900px",width:"100%"},children:[e.jsx("h1",{className:"title large left",style:{marginBottom:"1rem"},children:"# Comments"}),s?e.jsxs("form",{onSubmit:x,className:"page-body",children:[e.jsx("textarea",{placeholder:"Write a comment...",value:d,maxLength:i,onChange:y=>{const v=y.target.value;m(v),c(v.length)},rows:4,className:"textarea comment"}),e.jsxs("div",{className:"char-counter",children:[g," / ",i]}),e.jsx("button",{className:"button",disabled:p||!d.trim(),children:p?"Posting...":"Add Comment"})]}):e.jsx("p",{className:"post-summary",children:"Log in to write a comment."}),a?e.jsx("p",{children:"Loading comments..."}):t.length===0?e.jsx("p",{style:{marginTop:"1rem"},className:"error block",children:"No comments yet"}):e.jsx("div",{className:"comments-list",style:{marginBottom:"5rem"},children:t.map(y=>e.jsx("div",{className:"comment-wrapper",children:e.jsx(Se,{postId:o,comment:y,setComments:r})},y._id))})]})}function Ce(){const{id:o}=z(),s=B(),[t,r]=l.useState(null),[a,n]=l.useState(!1),{isLoggedIn:i,role:d}=b();l.useEffect(()=>{o&&U.getPostById(o).then(g=>r(g)).catch(()=>r(null))},[o]);const m=async()=>{if(!(!o||!confirm("Are you sure you want to delete this post?"))){n(!0);try{await U.deletePost(o),s("/blog")}catch{alert("Failed to delete post"),n(!1)}}};return t?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"header",children:[e.jsx(N,{to:"/blog",className:"link",children:"$ cd ../"}),i&&d==="admin"&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:m,disabled:a,className:"button compact delete",children:a?"Deleting...":"Delete"}),e.jsx(N,{to:`/blog/edit/${o}`,className:"button compact",children:"Edit Post"})]})]}),e.jsxs("div",{className:"post-content",children:[e.jsxs("h1",{className:"title large left",children:[" # ",t.title]}),e.jsx("div",{className:"post-summary",children:t.summary}),e.jsx("div",{className:"post-body",children:e.jsx(Le,{content:t.content})})]}),e.jsx(Te,{postId:o})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"page-container",children:[e.jsx(N,{to:"/blog",className:"link",children:"$ cd ../"}),e.jsx("p",{children:"No post found"})]})})}class Pe{static async uploadFile(s){try{const t=new FormData;t.append("file",s);const r=await fetch(`${f}/uploads`,{method:"POST",credentials:"include",body:t});if(!r.ok){let a=r.statusText;try{const n=await r.json();a=n?.message||n?.error||a}catch{}throw new Error(`Failed to upload file: ${a}`)}return await r.json()}catch(t){throw console.error("Error uploading file:",t),t}}static async deleteUpload(s){try{const t=await fetch(`${f}/uploads/${s}`,{method:"DELETE",credentials:"include"});if(!t.ok){let r=t.statusText;try{const a=await t.json();r=a?.message||a?.error||r}catch{}throw new Error(`Failed to delete upload: ${r}`)}}catch(t){throw console.error(`Error deleting upload ${s}:`,t),t}}}function ee(){const o=B(),{id:s}=z(),{isLoggedIn:t}=b(),r=300,a=1e3,n=2e4,[i,d]=l.useState(""),[m,g]=l.useState(0),[c,p]=l.useState(""),[h,x]=l.useState(0),[y,v]=l.useState(""),[P,k]=l.useState(0),[D,T]=l.useState(""),[L,S]=l.useState(!1),[O,R]=l.useState(!1),[$,_]=l.useState([]),F=!!s,W=l.useRef(null);l.useEffect(()=>{t||o("/login")},[t,o]),l.useEffect(()=>{s&&(S(!0),U.getPostById(s).then(u=>{d(u.title),g(u.title.length),p(u.summary),x(u.summary.length),v(u.content),k(u.content.length)}).catch(()=>T("Failed to load post")).finally(()=>S(!1)))},[s]);const J=async u=>{try{await Pe.uploadFile(u);const j=`${f}/uploads/${u.name}`;_(C=>[...C,j])}catch(j){console.error("Upload error:",j)}},H=u=>{u.preventDefault(),R(!1),Array.from(u.dataTransfer.files).forEach(C=>J(C))},w=async()=>{const u=Ne(i,c,y);if(u)return T(u);try{S(!0),T(""),F&&s?await U.updatePost(s,{title:i,summary:c,content:y}):await U.createPost(i,c,y),o("/blog")}catch(j){const C=j?.response?.data?.message||j?.message||"Failed.";T(C)}finally{S(!1)}};return e.jsxs("div",{className:"editor-wrapper",children:[e.jsxs("div",{className:"editor-main",children:[e.jsx("h1",{style:{marginBottom:"1rem"},className:"title",children:F?"Edit Post":"Create New Post"}),D&&e.jsx("div",{className:"error block",children:D}),e.jsx("input",{type:"text",placeholder:"Title",value:i,maxLength:r,onChange:u=>{const j=u.target.value;d(j),g(j.length)},className:"input wide",disabled:L}),e.jsxs("div",{className:"char-counter",children:[m," / ",r]}),e.jsx("textarea",{placeholder:"Summary",value:c,maxLength:a,onChange:u=>{const j=u.target.value;p(j),x(j.length)},className:"textarea post-summary",disabled:L}),e.jsxs("div",{className:"char-counter",children:[h," / ",a]}),e.jsx("textarea",{placeholder:"Content",value:y,maxLength:n,onChange:u=>{const j=u.target.value;v(j),k(j.length)},className:"textarea post-content",disabled:L}),e.jsxs("div",{className:"char-counter",children:[P," / ",n]}),e.jsxs("div",{className:`dropzone ${O?"dragging":""}`,onDragOver:u=>{u.preventDefault(),R(!0)},onDragLeave:()=>R(!1),onDrop:H,onClick:()=>W.current?.click(),children:["Drag files here or ",e.jsx("strong",{children:"click to upload"}),e.jsx("input",{type:"file",multiple:!0,ref:W,style:{display:"none"},onChange:u=>{(u.target.files?Array.from(u.target.files):[]).forEach(C=>J(C)),u.target.value=""},disabled:L})]}),e.jsx("button",{onClick:w,className:"button wide",disabled:L||!i||!c||!y,children:L?"Saving...":F?"Update Post":"Create Post"})]}),e.jsxs("div",{className:"editor-sidebar",children:[e.jsx("h3",{children:"Uploaded URLs"}),$.length===0&&e.jsx("p",{className:"sidebar-empty",children:"No files yet"}),e.jsx("ul",{className:"file-list",children:$.map((u,j)=>e.jsx("li",{children:e.jsx("code",{children:u})},j))})]})]})}class A{static async getAllUsers(){try{const s=await fetch(`${f}/users`,{credentials:"include"});if(!s.ok){let t=s.statusText;try{const r=await s.json();t=r?.message||r?.error||t}catch{}throw new Error(`Failed to fetch users: ${t}`)}return await s.json()}catch(s){throw console.error("Error fetching users:",s),s}}static async getUserById(s){const t=await fetch(`${f}/users/${s}`,{credentials:"include"});if(!t.ok)throw new Error("Error fetching user");return t.json()}static async updateUserById(s){const t=s._id,r=await fetch(`${f}/users/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!r.ok)throw new Error("Error updating user");return r.json()}static async updateUserPassword(s){const t=s._id,r=await fetch(`${f}/users/pwd/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!r.ok)throw new Error("Error changing password");return r.json()}static async deleteUserById(s){if(!(await fetch(`${f}/users/${s}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Error deleting user")}}const te=()=>{const{_id:o,logout:s,role:t,isLoading:r}=b(),{userId:a}=z(),n=B(),i=a??o,[d,m]=l.useState(null),[g,c]=l.useState(!0),[p,h]=l.useState(""),[x,y]=l.useState(""),[v,P]=l.useState(""),[k,D]=l.useState(""),[T,L]=l.useState(""),[S,O]=l.useState(""),[R,$]=l.useState(""),[_,F]=l.useState("");l.useEffect(()=>{r||(a&&a!==o&&t!=="admin"||a&&a===o)&&n("/dashboard")},[a,o,t,n,r]),l.useEffect(()=>{if(!i){c(!1);return}A.getUserById(i).then(w=>{m(w),h(w.name),y(w.email)}).finally(()=>c(!1))},[i]);const W=async w=>{if(w.preventDefault(),!i)return;const u={_id:i,name:p,email:x};try{const j=await A.updateUserById(u);m(j),O("Profile updated!")}catch{O("Failed to update profile")}},J=async w=>{if(w.preventDefault(),!i)return;if(k!==T){$("New passwords do not match");return}const u={_id:i,currentPassword:v,newPassword:k};try{await A.updateUserPassword(u),$("Password changed successfully"),P(""),D(""),L("")}catch{$("Failed to change password")}},H=async()=>{if(!(!i||!window.confirm("Are you sure?")))try{await A.deleteUserById(i),i===o?(s(),n("/")):n("/users")}catch{F("Failed to delete user")}};return r?e.jsx("div",{className:"page-container",children:e.jsx("p",{children:"Loading..."})}):o?g?e.jsx("div",{className:"page-container",children:e.jsx("p",{children:"Loading..."})}):d?e.jsxs("div",{className:"page-container",style:{gap:"1.5rem"},children:[t==="admin"?e.jsx("div",{className:"header",style:{marginBottom:"1rem"},children:e.jsx(N,{to:"/users",className:"link",children:"$ cd ../"})}):e.jsx("div",{className:"header",style:{marginBottom:"1rem"},children:e.jsx(N,{to:"/",className:"link",children:"$ cd ../"})}),e.jsx("h1",{className:"title large left",style:{maxWidth:"900px",width:"100%"},children:"# User Dashboard"}),e.jsx("div",{className:"user-list",style:{maxWidth:"900px",marginTop:"1rem"},children:e.jsxs("div",{className:"user-row",style:{gridTemplateColumns:"1fr"},children:[e.jsxs("div",{className:"user-name",children:[e.jsx("strong",{children:"Name:"})," ",d.name]}),e.jsxs("div",{className:"user-email",children:[e.jsx("strong",{children:"Email:"})," ",d.email]}),e.jsxs("div",{className:"user-role",children:[e.jsx("strong",{children:"Role:"})," ",d.role]})]})}),e.jsxs("div",{className:"container",style:{maxWidth:"900px",padding:"1.2rem",gap:"1rem"},children:[e.jsx("h1",{className:"title left",style:{marginBottom:"-1rem",fontSize:"1.4rem"},children:"> Edit Profile"}),e.jsxs("form",{onSubmit:W,style:{justifyContent:"right"},children:[e.jsxs("div",{className:"user-list",children:[e.jsxs("div",{className:"user-row",style:{gridTemplateColumns:"1fr 4fr"},children:[e.jsx("div",{className:"user-name",children:"Name"}),e.jsx("input",{type:"text",className:"input",value:p,onChange:w=>h(w.target.value)})]}),e.jsxs("div",{className:"user-row",style:{gridTemplateColumns:"1fr 4fr"},children:[e.jsx("div",{className:"user-email",children:"Email"}),e.jsx("input",{type:"email",className:"input",value:x,onChange:w=>y(w.target.value)})]})]}),e.jsx("button",{className:"button compact",style:{marginTop:"1rem"},children:"Save Profile"})]}),S&&e.jsx("p",{className:"error block",children:S})]}),a?null:e.jsxs("div",{className:"container",style:{maxWidth:"900px",padding:"1.2rem",gap:"1rem"},children:[e.jsx("h1",{className:"title left",style:{marginBottom:"-1rem",fontSize:"1.4rem"},children:"> Change Password"}),e.jsxs("form",{onSubmit:J,style:{justifyContent:"right"},children:[e.jsxs("div",{className:"user-list",children:[e.jsxs("div",{className:"user-row",style:{gridTemplateColumns:"1fr 4fr"},children:[e.jsx("div",{className:"user-password",children:"Current Password"}),e.jsx("input",{type:"password",className:"input",value:v,onChange:w=>P(w.target.value)})]}),e.jsxs("div",{className:"user-row",style:{gridTemplateColumns:"1fr 4fr"},children:[e.jsx("div",{className:"user-password",children:"New Password"}),e.jsx("input",{type:"password",className:"input",value:k,onChange:w=>D(w.target.value)})]}),e.jsxs("div",{className:"user-row",style:{gridTemplateColumns:"1fr 4fr"},children:[e.jsx("div",{className:"user-password",children:"Confirm Password"}),e.jsx("input",{type:"password",className:"input",value:T,onChange:w=>L(w.target.value)})]})]}),e.jsx("button",{className:"button compact",style:{marginTop:"1rem"},children:"Update Password"})]}),S&&e.jsx("p",{className:"error",children:S})]}),!a&&t==="admin"?e.jsxs("div",{className:"container",style:{maxWidth:"900px",padding:"1.2rem"},children:[e.jsx("h1",{className:"title left",style:{marginBottom:"0.5rem",fontSize:"1.4rem"},children:"> Danger Zone"}),e.jsx("button",{disabled:!0,style:{marginTop:"1rem"},className:"button delete compact",onClick:H,children:"Delete account"}),_&&e.jsx("p",{className:"error",children:_})]}):e.jsxs("div",{className:"container",style:{maxWidth:"900px",padding:"1.2rem"},children:[e.jsx("h1",{className:"title left",style:{marginBottom:"0.5rem",fontSize:"1.4rem"},children:"> Danger Zone"}),e.jsx("button",{style:{marginTop:"1rem"},className:"button delete compact",onClick:H,children:"Delete account"}),_&&e.jsx("p",{className:"error",children:_})]})]}):e.jsxs("div",{className:"page-container",children:[e.jsx(N,{to:"/",className:"link",children:"$ cd ../"}),e.jsx("p",{children:"User not found"})]}):e.jsx("div",{className:"page-container",children:e.jsxs("p",{children:["You must ",e.jsx(N,{to:"/login",className:"link",children:"log in"}),"."]})})};function ke(){const[o,s]=l.useState([]),[t,r]=l.useState(!0),[a,n]=l.useState(""),{_id:i,role:d,isLoading:m}=b();l.useEffect(()=>{if(!m){if(d!=="admin"){r(!1),n("Unauthorized access.");return}A.getAllUsers().then(c=>{s(c),c.length===0&&n("No available users.")}).catch(()=>n("Error loading users.")).finally(()=>r(!1))}},[d,m]);const g=async c=>{if(!(!c||!window.confirm("Are you sure?")))try{await A.deleteUserById(c),s(h=>h.filter(x=>x._id!==c))}catch{console.error("Failed to delete user")}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"header",children:[e.jsx(N,{to:"/",className:"link",children:"$ cd ../"}),e.jsx(N,{to:"/signup",className:"button compact",children:"Create New Admin"})]}),e.jsx("div",{className:"user-content",children:e.jsx("h1",{className:"title large left",children:"# Users"})}),t?e.jsx("p",{children:"Loading users..."}):a?e.jsx("p",{className:"error",children:a}):e.jsx("ul",{className:"user-list",children:o.map(c=>e.jsxs("div",{className:"user-row",children:[e.jsx(N,{to:`/dashboard/${c._id}`,className:"user-name",children:c.name}),e.jsx("div",{className:"user-email",children:c.email}),e.jsxs("div",{className:"user-role",children:["Role: ",c.role]}),e.jsx("div",{className:"user-actions",children:i===c._id?e.jsx("button",{className:"button delete compact",disabled:!0,onClick:()=>g(c._id),children:"Delete"}):e.jsx("button",{className:"button delete compact",onClick:()=>g(c._id),children:"Delete"})})]},c._id))})]})})}const I=({children:o,requiredRole:s})=>{const{isLoggedIn:t,role:r,isLoading:a}=b();return a?null:t?s&&r!==s?e.jsx(V,{to:"/",replace:!0}):e.jsx(e.Fragment,{children:o}):e.jsx(V,{to:"/login",replace:!0})};function $e(){const o=new Date().getFullYear();return e.jsx("footer",{className:"footer",children:e.jsxs("div",{className:"footer-content",children:[e.jsxs("p",{children:["© ",o," My Blog. All rights reserved."]}),e.jsx("div",{className:"footer-links",children:e.jsx("a",{href:"https://github.com/mariogarcia79/",target:"_blank",rel:"noopener noreferrer",className:"link",children:"GitHub"})})]})})}function _e(){return e.jsxs(ne,{children:[e.jsx("header",{children:e.jsx(ge,{})}),e.jsxs("main",{className:"page-container",children:[e.jsxs(oe,{children:[e.jsx(E,{path:"/",element:e.jsx(xe,{})}),e.jsx(E,{path:"/signup",element:e.jsx(ve,{})}),e.jsx(E,{path:"/login",element:e.jsx(be,{})}),e.jsx(E,{path:"/blog",element:e.jsx(Ee,{})}),e.jsx(E,{path:"/blog/:id",element:e.jsx(Ce,{})}),e.jsx(E,{path:"/blog/new",element:e.jsx(I,{requiredRole:"admin",children:e.jsx(ee,{})})}),e.jsx(E,{path:"/blog/edit/:id",element:e.jsx(I,{requiredRole:"admin",children:e.jsx(ee,{})})}),e.jsx(E,{path:"/users",element:e.jsx(I,{requiredRole:"admin",children:e.jsx(ke,{})})}),e.jsx(E,{path:"/dashboard",element:e.jsx(I,{children:e.jsx(te,{})})}),e.jsx(E,{path:"/dashboard/:userId",element:e.jsx(I,{requiredRole:"admin",children:e.jsx(te,{})})})]}),e.jsx($e,{})]})]})}const re=document.getElementById("root");if(!re)throw new Error("Failed to find the root element");ie.createRoot(re).render(e.jsx(le.StrictMode,{children:e.jsx(he,{children:e.jsx(_e,{})})}));
